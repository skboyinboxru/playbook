---

- name: Prepare all hosts
  hosts: all
  gather_facts: no
  tasks:
    
    - name: Install Python 3 on CentOS 7
      raw: |
        if [ -f /etc/redhat-release ]; then
          yum install -y python3 python3-pip
        else
          echo "Unsupported OS"
          exit 1
        fi
      register: python_install
      changed_when: "'already installed' not in python_install.stdout"
    
    - name: Set Python 3 interpreter
      set_fact:
        ansible_python_interpreter: /usr/bin/python3
    
    - name: Gather facts
      setup:

- name: Install ClickHouse
  hosts: clickhouse
  roles:
    - clickhouse
  tags: clickhouse

- name: Install Vector
  hosts: vector
  roles:
    - vector-role
  tags: vector

- name: Install Lighthouse
  hosts: lighthouse
  roles:
    - lighthouse-role
  tags: lighthouse